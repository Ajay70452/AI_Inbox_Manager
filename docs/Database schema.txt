 A. ERD (ASCII Diagram)
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚        users         â”‚
                            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                            â”‚ id (PK)              â”‚
                            â”‚ name                 â”‚
                            â”‚ email                â”‚
                            â”‚ password_hash        â”‚
                            â”‚ created_at           â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚ 1:N
                                      â”‚
                                      â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚      account_tokens        â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚ id (PK)                    â”‚
                   â”‚ user_id (FK -> users.id)   â”‚
                   â”‚ provider (gmail/outlook)   â”‚
                   â”‚ access_token               â”‚
                   â”‚ refresh_token (encrypted)  â”‚
                   â”‚ expires_at                 â”‚
                   â”‚ email_address              â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


users 1:N threads
threads 1:N emails
threads 1:1 ai_thread_summary
threads 1:1 ai_priority
threads 1:1 ai_sentiment
threads 1:N tasks
threads 1:1 ai_reply_draft


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       threads        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)              â”‚
â”‚ user_id (FK)         â”‚
â”‚ thread_id_provider   â”‚
â”‚ subject              â”‚
â”‚ last_message_at      â”‚
â”‚ created_at           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ 1:N
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         emails          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                 â”‚
    â”‚ thread_id (FK)          â”‚
    â”‚ user_id (FK)            â”‚
    â”‚ email_id_provider       â”‚
    â”‚ sender                  â”‚
    â”‚ recipients              â”‚
    â”‚ body_html_url           â”‚
    â”‚ body_text_clean         â”‚
    â”‚ timestamp               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    ai_thread_summary      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                   â”‚
    â”‚ thread_id (FK)            â”‚
    â”‚ summary_text              â”‚
    â”‚ model_used                â”‚
    â”‚ created_at                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        ai_priority        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                   â”‚
    â”‚ thread_id (FK)            â”‚
    â”‚ priority_level            â”‚
    â”‚ category                  â”‚
    â”‚ created_at                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       ai_sentiment        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                   â”‚
    â”‚ thread_id (FK)            â”‚
    â”‚ sentiment_score           â”‚
    â”‚ sentiment_label           â”‚
    â”‚ anger_level               â”‚
    â”‚ urgency_score             â”‚
    â”‚ created_at                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          tasks            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                   â”‚
    â”‚ thread_id (FK)            â”‚
    â”‚ title                     â”‚
    â”‚ description               â”‚
    â”‚ due_date                  â”‚
    â”‚ extracted_owner           â”‚
    â”‚ status                    â”‚
    â”‚ created_at                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      ai_reply_draft        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ id (PK)                    â”‚
    â”‚ thread_id (FK)             â”‚
    â”‚ draft_text                 â”‚
    â”‚ tone_used                  â”‚
    â”‚ created_at                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        company_context         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                        â”‚
â”‚ user_id (FK)                   â”‚
â”‚ tone                           â”‚
â”‚ company_description            â”‚
â”‚ products (JSON)                â”‚
â”‚ policies (JSON)                â”‚
â”‚ faq (JSON)                     â”‚
â”‚ roles (JSON)                   â”‚
â”‚ created_at                     â”‚
â”‚ updated_at                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         integrations           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                        â”‚
â”‚ user_id (FK)                   â”‚
â”‚ type (slack/notion/clickupâ€¦)  â”‚
â”‚ access_token                   â”‚
â”‚ refresh_token                  â”‚
â”‚ workspace_id / team_id         â”‚
â”‚ metadata (JSON)                â”‚
â”‚ created_at                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       sync_job_logs            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                        â”‚
â”‚ user_id (FK)                   â”‚
â”‚ provider (gmail/outlook)       â”‚
â”‚ status (success/error)         â”‚
â”‚ run_time_ms                    â”‚
â”‚ message                        â”‚
â”‚ created_at                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ—„ï¸ B. Table-by-Table Schema Definitions
Below are the exact table designs you will implement in PostgreSQL.

1. users
id (UUID, PK)
name (text)
email (text, unique)
password_hash (text)
created_at (timestamp)

2. account_tokens
Stores Gmail & Outlook tokens.
id (UUID, PK)
user_id (FK)
provider (varchar)      -- gmail / outlook
email_address (text)
access_token (text)
refresh_token (text encrypted)
expires_at (timestamp)
created_at (timestamp)

3. threads
id (UUID, PK)
user_id (FK)
thread_id_provider (varchar)  -- Gmail thread id or Outlook conversation id
subject (text)
last_message_at (timestamp)
created_at (timestamp)

4. emails
id (UUID, PK)
thread_id (FK)
user_id (FK)
email_id_provider (varchar)
sender (text)
recipients (jsonb)
body_html_url (text)       -- stored in S3/R2
body_text_clean (text)
timestamp (timestamp)

5. ai_thread_summary
id (UUID, PK)
thread_id (FK)
summary_text (text)
model_used (varchar)
created_at (timestamp)

6. ai_priority
id (UUID, PK)
thread_id (FK)
priority_level (varchar)   -- urgent, customer, vendor, internal, low
category (varchar)
created_at (timestamp)

7. ai_sentiment
id (UUID, PK)
thread_id (FK)
sentiment_score (float)
sentiment_label (varchar)  -- positive, neutral, negative
anger_level (float)
urgency_score (float)
created_at (timestamp)

8. tasks
id (UUID, PK)
thread_id (FK)
title (text)
description (text)
due_date (timestamp null)
extracted_owner (varchar)
status (varchar default 'pending')
created_at (timestamp)

9. ai_reply_draft
id (UUID, PK)
thread_id (FK)
draft_text (text)
tone_used (varchar)
created_at (timestamp)

10. company_context
id (UUID, PK)
user_id (FK)
tone (text)
company_description (text)
products (jsonb)
policies (jsonb)
faq (jsonb)
roles (jsonb)
created_at (timestamp)
updated_at (timestamp)

11. integrations
id (UUID, PK)
user_id (FK)
type (varchar)              -- slack/notion/clickup/jira/trello
access_token (text)
refresh_token (text)
workspace_id (text)
metadata (jsonb)
created_at (timestamp)

12. sync_job_logs
id (UUID, PK)
user_id (FK)
provider (varchar)          -- gmail/outlook
status (varchar)
run_time_ms (int)
message (text)
created_at (timestamp)

âœ”ï¸ This ERD fully supports all Phase-1 MVP features:
OAuth
Email sync
Thread summaries
Priority classification
Sentiment detection
Task extraction
Auto-reply drafting
Company context
Integrations
Analytics
Logging/debugging
Everything fits cleanly into FastAPI + PostgreSQL.
